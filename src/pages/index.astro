---
import PageLayout from '@/layouts/BaseLayout.astro'
import { Image } from 'astro:assets'

import PostPreview from '@/components/blog/PostPreview.astro'
import Section from '@/components/home/Section.astro'
import { Button, Card, Label } from '@/components/user'
import { getAllCollections, sortMDByDate } from '@/utils'
import avatar from '@/assets/about/7.jpeg'
import { siteConfig } from '@/site-config'

const MAX_POSTS = 10
const allPosts = await getAllCollections()
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS)
---

<style>
  /* Define theme variables for consistency */
  :root {
    --primary-color: #0077ed;
    --primary-color-dark: #0082f7;
    --secondary-color: #f0f0f0;
    /* Unify gradient colors with primary color */
    --gradient-start: #0077ed;
    --gradient-end: #9198e5;
    --gradient-deg: 45deg;
    --bg-light: white;
    --bg-dark: #1f2937; /* Tailwind gray-800 for a softer dark */
    --shadow-light: rgba(0, 0, 0, 0.1);
    --shadow-dark: rgba(0, 0, 0, 0.2);
  }

  .image-wrapper {
    margin-right: 24px;
    width: 40%;
    height: auto;
  }

  .content {
    overflow: auto; /* Clear floats */
  }

  /* Enhanced dynamic border with a gradient outline */
  .dynamic-border {
    border: 2px solid transparent;
    border-radius: 12px;
    padding: 16px;
    background:
      linear-gradient(var(--bg-light), var(--bg-light)) padding-box,
      linear-gradient(var(--gradient-deg), var(--gradient-start), var(--gradient-end)) border-box;
    box-shadow: 0 4px 6px var(--shadow-light);
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .dynamic-border:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 8px var(--shadow-dark);
  }

  /* Refined modern button with interactive icons */
  .apple-modern-button {
    background: none !important;
    border-radius: 12px !important;
    padding: 12px 28px !important;
    font-size: 15px !important;
    font-weight: 500 !important;
    letter-spacing: -0.01em !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 8px !important;
    transition:
      background-color 0.2s ease,
      transform 0.2s ease;
  }

  .apple-modern-button:hover {
    background-color: var(--secondary-color) !important;
  }

  .apple-modern-button svg {
    width: 16px;
    height: 16px;
    transition: transform 0.2s ease;
  }

  .apple-modern-button:hover svg {
    transform: translateX(2px);
  }

  /* æ·»åŠ å¤œé—´æ¨¡å¼æ ·å¼ */
  :global(.dark) {
    --secondary-color: rgba(255, 255, 255, 0.1);
  }

  :global(.dark) .dynamic-border {
    background:
      linear-gradient(var(--bg-dark), var(--bg-dark)) padding-box,
      linear-gradient(var(--gradient-deg), var(--gradient-start), var(--gradient-end)) border-box;
  }

  :global(.dark) .apple-modern-button {
    color: var(--text-primary-dark, #fff) !important;
  }

  :global(.dark) .apple-modern-button:hover {
    background-color: rgba(255, 255, 255, 0.1) !important;
  }

  /* æ·»åŠ æ–‡æœ¬æ¸å˜æ•ˆæœ */
  .gradient-text {
    background: linear-gradient(
      90deg,
      var(--gradient-start),
      var(--gradient-end),
      var(--gradient-start)
    );
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: gradientFlow 6s ease infinite;
    background-size: 400% 100%;
    padding-bottom: 2px; /* Add padding to prevent text from being cut off */
  }

  @keyframes gradientFlow {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* åŠ è½½åŠ¨ç”» */
  .loading-dots {
    animation: loadingDots 1.5s infinite;
  }

  @keyframes loadingDots {
    0%,
    20% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
    100% {
      opacity: 1;
    }
  }

  /* ç‚¹å‡»åˆ·æ–°æ ·å¼ */
  #total-pageview-count {
    cursor: pointer;
  }

  #total-pageview-count:hover {
    color: var(--primary-color, #0077ed);
  }

  /* ç®€æ´çš„è„‰å†²åŠ è½½æ•ˆæœ */
  .pageview-counter-wrapper {
    display: inline-block;
    position: relative;
  }

  /* è„‰å†²åŠ¨ç”» */
  .pulse-loading {
    animation: pulseLoad 2s ease-in-out infinite;
  }

  @keyframes pulseLoad {
    0%,
    100% {
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(0, 122, 255, 0.4);
    }
    50% {
      transform: scale(1.02);
      box-shadow: 0 0 0 8px rgba(0, 122, 255, 0);
    }
  }

  /* å¤œé—´æ¨¡å¼çš„è„‰å†²æ•ˆæœ */
  :global(.dark) .pulse-loading {
    animation: pulseLoadDark 2s ease-in-out infinite;
  }

  @keyframes pulseLoadDark {
    0%,
    100% {
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(10, 132, 255, 0.4);
    }
    50% {
      transform: scale(1.02);
      box-shadow: 0 0 0 8px rgba(10, 132, 255, 0);
    }
  }

  /* åŠ è½½æŒ‡ç¤ºå™¨ */
  .loading-indicator {
    display: none; /* å®Œå…¨ä¸å æ®ç©ºé—´ */
    align-items: center;
    gap: 6px;
    margin-left: 6px;
  }

  .loading-indicator.show {
    display: inline-flex;
  }

  /* ç®€æ´çš„è¿›åº¦æ¡ */
  .progress-bar {
    width: 32px;
    height: 2px;
    background-color: rgba(0, 122, 255, 0.15);
    border-radius: 1px;
    overflow: hidden;
    position: relative;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #007aff, #5ac8fa);
    border-radius: 1px;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    width: 0%;
  }

  /* è¿›åº¦æ–‡æœ¬ */
  .progress-text {
    font-size: 10px;
    color: #007aff;
    font-weight: 500;
    min-width: 24px;
    text-align: center;
  }

  /* å¤œé—´æ¨¡å¼ */
  :global(.dark) .progress-bar {
    background-color: rgba(10, 132, 255, 0.2);
  }

  :global(.dark) .progress-fill {
    background: linear-gradient(90deg, #0a84ff, #5ac8fa);
  }

  :global(.dark) .progress-text {
    color: #0a84ff;
  }

  /* Tooltipæ ·å¼ */
  .pageview-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 8px;
    padding: 10px 14px;
    background-color: rgba(255, 255, 255, 0.95);
    color: #1f2937;
    border-radius: 8px;
    font-size: 12px;
    line-height: 1.4;
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.3s ease,
      visibility 0.3s ease,
      transform 0.3s ease;
    transform: translateX(-50%) translateY(-4px);
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  }

  .pageview-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 5px solid transparent;
    border-top-color: rgba(255, 255, 255, 0.95);
  }

  .pageview-counter-wrapper:hover .pageview-tooltip {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(0);
  }

  /* å¤œé—´æ¨¡å¼tooltip */
  :global(.dark) .pageview-tooltip {
    background-color: rgba(0, 0, 0, 0.9);
    color: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  :global(.dark) .pageview-tooltip::after {
    border-top-color: rgba(0, 0, 0, 0.9);
  }

  /* Tooltipå†…å®¹æ ·å¼ */
  .tooltip-item {
    display: flex;
    align-items: center;
    gap: 6px;
    margin: 2px 0;
  }

  .tooltip-item:first-child {
    margin-top: 0;
  }

  .tooltip-item:last-child {
    margin-bottom: 0;
  }

  .tooltip-label {
    font-weight: 600;
    color: #007aff;
  }

  :global(.dark) .tooltip-label {
    color: #0a84ff;
  }
</style>

<PageLayout meta={{ title: 'Home' }} highlightColor='#659EB966'>
  <div class='flex w-full flex-col gap-y-10 md:w-4/5 lg:w-5/6'>
    <section class='animate flex flex-col items-center gap-y-8'>
      <div class='flex items-center gap-x-6'>
        <div
          class='flex-shrink-0 overflow-hidden rounded-full shadow-sm transition-shadow duration-300 hover:shadow-md'
        >
          <Image src={avatar} alt='profile' class='h-40 w-40 object-cover' loading='eager' />
        </div>

        <div class='flex flex-col items-start gap-y-4'>
          <h1 class='text-4xl font-medium tracking-tight'>{siteConfig.author}</h1>
          <div class='flex flex-wrap gap-x-5 gap-y-3'>
            <Label
              title='Beijing Â· China'
              class='text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100'
            >
              <svg class='size-5' slot='icon'>
                <use href='/icons/social.svg#mingcute-location-line'></use>
              </svg>
            </Label>
            <Label
              as='a'
              href='https://www.travellings.cn/go.html'
              target='_blank'
              title='Travelling'
              class='text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100'
            >
              <svg class='size-4' slot='icon'>
                <use href='/icons/social.svg#fontawesome-train'></use>
              </svg>
            </Label>
          </div>
        </div>
      </div>
    </section>

    <div class='mb-0 mt-0 flex flex-wrap justify-center text-sm'>
      <div class='pageview-counter-wrapper'>
        <div
          id='pageview-counter'
          class='pageview-counter flex items-center gap-2 rounded-full border border-gray-200 px-4 py-2 shadow-sm dark:border-gray-700'
        >
          <svg
            class='size-4 text-blue-500'
            xmlns='http://www.w3.org/2000/svg'
            viewBox='0 0 24 24'
            fill='none'
            stroke='currentColor'
            stroke-width='2'
            stroke-linecap='round'
            stroke-linejoin='round'
          >
            <line x1='18' y1='20' x2='18' y2='10'></line>
            <line x1='12' y1='20' x2='12' y2='4'></line>
            <line x1='6' y1='20' x2='6' y2='14'></line>
          </svg>
          <span class='text-gray-700 dark:text-gray-300'>
            <span class='inline-flex items-center gap-1.5'>
              <span
                >Home <span class='waline-pageview-count font-medium' data-path='/'>-</span></span
              >
              <span class='text-gray-400'>|</span>
              <span class='inline-flex items-center gap-1'>
                <span
                  >Site <span
                    id='total-pageview-count'
                    class='font-medium transition-all duration-300'
                    title='Click to refresh (includes all blog posts)'>-</span
                  ></span
                >
                <div id='loading-indicator' class='loading-indicator'>
                  <div class='progress-bar'>
                    <div id='progress-fill' class='progress-fill'></div>
                  </div>
                  <span id='progress-text' class='progress-text'>0%</span>
                </div>
              </span>
            </span>
          </span>
        </div>
        <div class='pageview-tooltip'>
          <div class='tooltip-item'>
            <span class='tooltip-label'>Home:</span>
            <span>Homepage (this page) visit count</span>
          </div>
          <div class='tooltip-item'>
            <span class='tooltip-label'>Site:</span>
            <span>All pages visit count</span>
          </div>
        </div>
      </div>
    </div>

    <Section title='About'>
      <p>
        Hi there! ğŸ‘‹ I'm Yutong Liang, a 4th-year undergraduate at the School of EECS, Peking
        University, majoring in Computer Science.
      </p>
      <p>
        I have a vision of creating generalist agents that can do what we humans can do. I'm
        particularly interested in endowing them with human-level dexterity to master complex
        human-object interaction (HOI) and in-hand manipulation tasks.
      </p>
      <Button title='More About Me' class='apple-modern-button w-fit' href='/about' style='ahead'>
        More About Me
      </Button>
    </Section>

    <Section title='Education'>
      <Card
        as='a'
        heading='Peking University'
        subheading='Bachelor of Science'
        date='September 1, 2021 - July 2, 2025'
        href='https://english.pku.edu.cn/'
        imagePath='/src/assets/homepage/pku.png'
      >
        <ul class='ms-4 list-disc text-muted-foreground'>
          <li>Specialty: Computer Science and Technology</li>
          <li>Location: Beijing, China</li>
        </ul>
      </Card>
      <Card
        as='a'
        heading='Nankai High School'
        subheading='High School Diploma'
        date='September 2018 - July 2021'
        href='https://nkzx.tj.edu.cn/'
        imagePath='/src/assets/homepage/nk.png'
      >
        <ul class='ms-4 list-disc text-muted-foreground'>
          <li>Location: Tianjin, China</li>
        </ul>
      </Card>
    </Section>

    {
      allPostsByDate.length > 0 && (
        <Section title='Blogs'>
          <ul class='flex flex-col gap-y-1.5 sm:gap-y-2'>
            {allPostsByDate.map((p) => (
              <li class='flex flex-col gap-x-2 sm:flex-row'>
                <PostPreview post={p} />
              </li>
            ))}
          </ul>
          <Button title='More blogs' class='apple-modern-button w-fit' href='/blog' style='ahead' />
        </Section>
      )
    }
  </div>
</PageLayout>

<script>
  import { initPageviewCounter } from '@/utils/pageview.js'

  // åˆå§‹åŒ–é¡µé¢è®¿é—®é‡ç»Ÿè®¡åŠŸèƒ½
  initPageviewCounter()
</script>
